<form class="cw cw-item-sheet" autocomplete="off">
  <header class="sheet-header flexrow">
    <img class="profile" src="{{item.img}}" data-edit="img"/>
    <div class="header-fields">
      <h1><input name="name" type="text" value="{{item.name}}" placeholder="Name"/></h1>
      <div class="grid-3">
        <label>Category</label>
        <select name="system.category">
          {{#each categories as |c|}}<option {{#if (eq ../system.category c)}}selected{{/if}}>{{c}}</option>{{/each}}
        </select>
        <label>TL</label><input name="system.techLevel" type="number" value="{{system.techLevel}}"/>
        <label>Legality</label>
        <select name="system.legal">
          {{#each legality as |l|}}<option {{#if (eq ../system.legal l)}}selected{{/if}}>{{l}}</option>{{/each}}
        </select>
      </div>
      <div class="grid-2">
        <label>Cost</label><input name="system.cost" type="number" value="{{system.cost}}"/>
        <label>Notes</label><input name="system.description" type="text" value="{{system.description}}"/>
      </div>
    </div>
  </header>

  <section class="sheet-body">
    <nav class="tabs" data-group="primary">
      <a class="item" data-tab="details">Details</a>
      <a class="item" data-tab="effects">Effects</a>
    </nav>

    <div class="tab" data-group="primary" data-tab="details">
      <textarea name="system.description" rows="6" placeholder="Description...">{{system.description}}</textarea>
    </div>

    <div class="tab" data-group="primary" data-tab="effects">
  {{#each item.system.effects as |eff i|}}
    <fieldset class="cw-effect space-y-2">
      <legend>
        <input name="system.effects.{{i}}.label" value="{{eff.label}}" placeholder="Effect label" />
        <button type="button" class="effect-remove" data-index="{{i}}" title="Remove effect">üóëÔ∏è</button>
      </legend>

      <div class="grid-3">
        <label>Tags (csv)</label>
        <input name="system.effects.{{i}}.when.tagsCsv" value="{{eff.when.tagsCsv}}" placeholder="cold, survival"/>

        <label>Roll Type</label>
        <select name="system.effects.{{i}}.when.rollType">
          <option value=""        {{#if (eq eff.when.rollType "")}}selected{{/if}}>(any)</option>
          <option value="standard"{{#if (eq eff.when.rollType "standard")}}selected{{/if}}>standard</option>
          <option value="initiative"{{#if (eq eff.when.rollType "initiative")}}selected{{/if}}>initiative</option>
          <option value="save"    {{#if (eq eff.when.rollType "save")}}selected{{/if}}>save</option>
        </select>
      </div>

      <div class="mods">
        {{#each eff.mods as |m j|}}
          <div class="mod-row grid-4">
            <label>Path</label>
            <select name="system.effects.{{i}}.mods.{{j}}.path">
              <option value="dicePool"   {{#if (eq m.path "dicePool")}}selected{{/if}}>dicePool</option>
              <option value="initiative" {{#if (eq m.path "initiative")}}selected{{/if}}>initiative</option>
            </select>

            <label>Op</label>
            <select name="system.effects.{{i}}.mods.{{j}}.op">
              <option value="add" {{#if (eq m.op "add")}}selected{{/if}}>add</option>
            </select>

            <label>Value</label>
            <input type="number" name="system.effects.{{i}}.mods.{{j}}.value" value="{{m.value}}" step="1"/>

            <button type="button" class="mod-remove" data-index="{{i}}" data-mod="{{j}}" title="Remove modifier">‚úñ</button>
          </div>
        {{/each}}
        <button type="button" class="mod-add" data-index="{{i}}">+ Add Modifier</button>
      </div>
    </fieldset>
  {{/each}}

  <button type="button" class="add-effect">Add Effect</button>
</div>
  </section>
</form>
