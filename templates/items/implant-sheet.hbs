<form class="cw cw-item-sheet flexcol" autocomplete="off">
  <header class="sheet-header flexrow">
    <img class="profile" src="{{item.img}}" data-edit="img"/>
    <div class="header-fields">
      <h1><input name="name" type="text" value="{{item.name}}" placeholder="Name"/></h1>
      <div class="grid-3">
        <label>Category</label>
        <select name="system.category">
          {{#each categories as |c|}}<option {{#if (eq ../system.category c)}}selected{{/if}}>{{c}}</option>{{/each}}
        </select>
        <label>TL</label><input name="system.techLevel" type="number" value="{{system.techLevel}}"/>
        <label>Legality</label>
        <select name="system.legal">
          {{#each legality as |l|}}<option {{#if (eq ../system.legal l)}}selected{{/if}}>{{l}}</option>{{/each}}
        </select>
      </div>
      <div class="grid-2">
        <label>Cost</label><input name="system.cost" type="number" value="{{system.cost}}"/>
        <!-- Added Immune Load field here as requested by previous plan, good to have early -->
        <label>Immune Load</label><input name="system.immuneLoadCost" type="number" value="{{system.immuneLoadCost}}" placeholder="0"/>
      </div>
    </div>
  </header>

  <section class="sheet-body">
    <nav class="tabs" data-group="primary">
      <a class="item" data-tab="details">Details</a>
      <a class="item" data-tab="effects">Effects</a>
    </nav>

    <div class="tab" data-group="primary" data-tab="details">
      <textarea name="system.description" rows="6" placeholder="Description...">{{system.description}}</textarea>
    </div>

    <div class="tab" data-group="primary" data-tab="effects">
  {{#each effectsArray as |eff i|}}
    <fieldset class="cw-effect">
      <legend class="cw-flex">
        <input name="system.effects.{{i}}.label" value="{{eff.label}}" placeholder="Effect label"/>
        <button type="button" class="effect-remove" data-index="{{i}}" title="Remove effect" aria-label="Remove effect">üóëÔ∏è</button>
      </legend>

      <div class="cw-grid-3">
        <label>Tags</label>
        <input name="system.effects.{{i}}.tags" list="cw-tags-list" value="{{eff.tags}}"/>

        <label>Roll Type</label>
        <select name="system.effects.{{i}}.rollType">
        {{#select eff.rollType}}
        <option value="(any)">(any)</option>
        <option value="initiative">initiative</option>
        {{/select}}
        </select>
      </div>

      {{#each eff.mods as |m j|}}
        <div class="cw-grid-4">
          <select name="system.effects.{{i}}.mods.{{j}}.path">
            <option value="dicePool"   {{#if (eq m.path "dicePool")}}selected{{/if}}>dice pool</option>
            <option value="initiative" {{#if (eq m.path "initiative")}}selected{{/if}}>initiative</option>
            <option value="difficulty" {{#if (eq m.path "difficulty")}}selected{{/if}}>difficulty</option>
            <option value="successes"  {{#if (eq m.path "successes")}}selected{{/if}}>auto-successes</option>
          </select>

          <select name="system.effects.{{i}}.mods.{{j}}.op">
            <option value="add" {{#if (eq m.op "add")}}selected{{/if}}>add</option>
          </select>

          <input type="number" name="system.effects.{{i}}.mods.{{j}}.value" value="{{m.value}}"/>

          <button type="button" class="mod-remove" data-eff="{{i}}" data-mod="{{j}}">üóëÔ∏è</button>
        </div>
      {{/each}}

      <div>
        <button type="button" class="mod-add" data-index="{{i}}">+ Add Modifier</button>
      </div>
    </fieldset>
  {{/each}}

  <button type="button" class="add-effect">Add Effect</button>

  <datalist id="cw-tags-list">
    <option value="cold"/>
    <option value="survival"/>
    <option value="melee"/>
    <option value="ranged"/>
    <option value="fear"/>
  </datalist>
</div>

  </section>
</form>